<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ByzBot - BYZ AI Assistant</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <style>
    :root {
      --bg: #ffffff;
      --bg-alt: #f5f5f7;
      --bg-elev: #ffffff;
      --text: #1d1d1f;
      --sub: #6e6e73;
      --border: #d2d2d7;
      --accent: #000000;
      --radius: 22px;
      --radius-lg: 28px;
      --shadow: 0 18px 60px rgba(0,0,0,.08);
      --shadow-soft: 0 10px 30px rgba(0,0,0,.08);
      --ease: cubic-bezier(.2,.8,.2,1);
      --max: 1100px;
    }

    [data-theme="dark"] {
      --bg: #000000;
      --bg-alt: #1c1c1e;
      --bg-elev: #0b0b0c;
      --text: #f5f5f7;
      --sub: #a1a1a6;
      --border: #2c2c2e;
      --accent: #ffffff;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --shadow-soft: 0 10px 30px rgba(0,0,0,.35);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.55;
      transition: background .35s var(--ease), color .35s var(--ease);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .chatbot-wrapper {
      width: 100%;
      max-width: 480px;
      height: 700px;
      display: flex;
      flex-direction: column;
      background: var(--bg-elev);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      overflow: hidden;
      animation: slideUp 0.4s var(--ease);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chatbot-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: color-mix(in srgb, var(--bg) 86%, transparent);
      backdrop-filter: blur(18px);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .chatbot-avatar {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 80%, transparent));
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--bg);
      font-size: 20px;
      box-shadow: 0 4px 12px color-mix(in srgb, var(--accent) 30%, transparent);
    }

    .header-info h2 {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: -0.3px;
      margin-bottom: 2px;
    }

    .header-info .status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--sub);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #34C759;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .header-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg-elev);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s var(--ease);
      font-size: 14px;
    }

    .icon-btn:hover {
      background: var(--bg-alt);
      transform: translateY(-1px);
    }

    .chatbot-messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: var(--bg);
    }

    .chatbot-messages::-webkit-scrollbar {
      width: 4px;
    }

    .chatbot-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .chatbot-messages::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 2px;
    }

    .message {
      display: flex;
      gap: 12px;
      animation: fadeIn 0.3s var(--ease);
      max-width: 85%;
    }

    .message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message-avatar {
      width: 32px;
      height: 32px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .message.bot .message-avatar {
      background: var(--bg-alt);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .message.user .message-avatar {
      background: var(--accent);
      color: var(--bg);
    }

    .message-content {
      padding: 12px 16px;
      border-radius: 18px;
      font-size: 14px;
      line-height: 1.6;
      word-wrap: break-word;
    }

    .message.bot .message-content {
      background: var(--bg-alt);
      color: var(--text);
      border-bottom-left-radius: 4px;
      border: 1px solid var(--border);
    }

    .message.user .message-content {
      background: var(--accent);
      color: var(--bg);
      border-bottom-right-radius: 4px;
    }

    .message-content code {
      background: color-mix(in srgb, var(--accent) 10%, var(--bg-alt));
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 13px;
    }

    .message-content pre {
      background: color-mix(in srgb, var(--accent) 8%, var(--bg-alt));
      padding: 12px;
      border-radius: 10px;
      overflow-x: auto;
      margin: 8px 0;
      border: 1px solid var(--border);
    }

    .message-content pre code {
      background: none;
      padding: 0;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
      background: var(--bg-alt);
      border-radius: 18px;
      border-bottom-left-radius: 4px;
      border: 1px solid var(--border);
      width: fit-content;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--sub);
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.7;
      }
      30% {
        transform: translateY(-10px);
        opacity: 1;
      }
    }

    .quick-replies {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .quick-reply-btn {
      padding: 8px 14px;
      background: var(--bg-elev);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s var(--ease);
      font-weight: 500;
    }

    .quick-reply-btn:hover {
      background: var(--bg-alt);
      transform: translateY(-1px);
      border-color: var(--accent);
    }

    .chatbot-input {
      padding: 20px 24px;
      border-top: 1px solid var(--border);
      background: color-mix(in srgb, var(--bg) 86%, transparent);
      backdrop-filter: blur(18px);
    }

    .input-wrapper {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .input-wrapper input {
      flex: 1;
      padding: 12px 18px;
      border: 1px solid var(--border);
      border-radius: 24px;
      background: var(--bg-elev);
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
      outline: none;
      transition: all 0.2s var(--ease);
    }

    .input-wrapper input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 10%, transparent);
    }

    .input-wrapper input::placeholder {
      color: var(--sub);
    }

    .send-btn {
      width: 44px;
      height: 44px;
      border-radius: 22px;
      background: var(--accent);
      color: var(--bg);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s var(--ease);
      font-size: 16px;
    }

    .send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px color-mix(in srgb, var(--accent) 30%, transparent);
    }

    .send-btn:active {
      transform: scale(0.95);
    }

    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .error-message {
      background: color-mix(in srgb, #b42318 10%, var(--bg-alt));
      border: 1px solid color-mix(in srgb, #b42318 30%, var(--border));
      color: #b42318;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 13px;
      margin: 8px 0;
    }

    [data-theme="dark"] .error-message {
      background: rgba(180, 35, 24, 0.18);
      border-color: rgba(255, 155, 155, 0.22);
      color: #ff9b9b;
    }

    .welcome-message {
      text-align: center;
      padding: 32px 24px;
      color: var(--sub);
    }

    .welcome-message h3 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
    }

    .welcome-message p {
      font-size: 14px;
      line-height: 1.6;
    }

    .api-key-setup {
      background: color-mix(in srgb, var(--accent) 8%, var(--bg-alt));
      border: 1px solid color-mix(in srgb, var(--accent) 30%, var(--border));
      border-radius: 16px;
      padding: 20px;
      margin: 20px;
      text-align: center;
    }

    .api-key-setup h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text);
    }

    .api-key-setup p {
      font-size: 13px;
      color: var(--sub);
      margin-bottom: 16px;
      line-height: 1.6;
    }

    .api-key-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--bg-elev);
      color: var(--text);
      font-size: 13px;
      font-family: 'SF Mono', Monaco, monospace;
      margin-bottom: 12px;
      outline: none;
      transition: all 0.2s var(--ease);
    }

    .api-key-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 10%, transparent);
    }

    .api-key-btn {
      padding: 10px 20px;
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s var(--ease);
    }

    .api-key-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px color-mix(in srgb, var(--accent) 30%, transparent);
    }

    @media (max-width: 480px) {
      body {
        padding: 0;
      }
      .chatbot-wrapper {
        height: 100vh;
        border-radius: 0;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="chatbot-wrapper">
    <div class="chatbot-header">
      <div class="header-left">
        <div class="chatbot-avatar">
          <i class="fas fa-robot"></i>
        </div>
        <div class="header-info">
          <h2>ByzBot</h2>
          <div class="status">
            <span class="status-dot"></span>
            <span>Online</span>
          </div>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" id="clearBtn" title="Clear chat">
          <i class="fas fa-trash-alt"></i>
        </button>
        <button class="icon-btn" id="settingsBtn" title="Settings / Change API Key">
          <i class="fas fa-cog"></i>
        </button>
        <button class="icon-btn" id="themeBtn" title="Toggle theme">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>

    <div class="chatbot-messages" id="messages">
      <div id="apiKeySetup" class="api-key-setup">
        <h4>ðŸ”‘ Setup Required</h4>
        <p>To use ByzBot, you need an OpenAI API key. Don't worry, it's free to get started!</p>
        <input 
          type="password" 
          id="apiKeyInput" 
          class="api-key-input" 
          placeholder="Enter your OpenAI API key (sk-...)"
        >
        <button class="api-key-btn" id="saveApiKey">Save & Start Chatting</button>
        <p style="margin-top: 12px; font-size: 12px;">
          <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--accent); text-decoration: underline;">
            Get your API key here â†’
          </a>
        </p>
      </div>
      <div class="welcome-message" id="welcomeMessage" style="display: none;">
        <h3>ðŸ‘‹ Welcome to ByzBot!</h3>
        <p>I'm your AI assistant for BYZ. Ask me anything about events, bookings, locations, galleries, or anything else!</p>
      </div>
    </div>

    <div class="chatbot-input" id="chatInput" style="display: none;">
      <div class="input-wrapper">
        <input 
          type="text" 
          id="userInput" 
          placeholder="Ask me anything about BYZ..."
          autocomplete="off"
        >
        <button class="send-btn" id="sendBtn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // ==================== CONFIGURATION ====================
    let OPENAI_API_KEY = localStorage.getItem('byzbot-api-key') || '';
    const OPENAI_API_URL = 'https://api.openai.com/v1/chat/completions';

    // BYZ Context for the AI
    const BYZ_CONTEXT = `You are ByzBot, a helpful and friendly AI assistant for BYZ in the Hood, an entertainment company that creates unforgettable experiences through exclusive parties, legendary events, and vibrant community gatherings in Dar es Salaam, Tanzania.

Key Information:
- BYZ hosts two main event series: Groove and Tempo
- Events take place in Dar es Salaam, Tanzania
- They have memory galleries showcasing photos from past events
- Booking is done through their website booking pages
- They're known for creating amazing party experiences with great music and atmosphere

Be conversational, helpful, and enthusiastic about BYZ events. If asked about something you don't know, politely suggest they check the website or contact BYZ directly.`;

    // ==================== STATE MANAGEMENT ====================
    let conversationHistory = [];
    let isProcessing = false;

    // ==================== DOM ELEMENTS ====================
    const messagesContainer = document.getElementById('messages');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const themeBtn = document.getElementById('themeBtn');
    const apiKeySetup = document.getElementById('apiKeySetup');
    const welcomeMessage = document.getElementById('welcomeMessage');
    const chatInput = document.getElementById('chatInput');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const saveApiKeyBtn = document.getElementById('saveApiKey');

    // ==================== INITIALIZE ====================
    function init() {
      if (OPENAI_API_KEY) {
        showChatInterface();
      } else {
        showApiKeySetup();
      }
    }

    function showApiKeySetup() {
      apiKeySetup.style.display = 'block';
      welcomeMessage.style.display = 'none';
      chatInput.style.display = 'none';
    }

    function showChatInterface() {
      apiKeySetup.style.display = 'none';
      welcomeMessage.style.display = 'block';
      chatInput.style.display = 'block';
      userInput.focus();
    }

    // ==================== API KEY SETUP ====================
    saveApiKeyBtn.addEventListener('click', () => {
      const key = apiKeyInput.value.trim();
      if (!key) {
        alert('Please enter your API key');
        return;
      }
      if (!key.startsWith('sk-')) {
        alert('API key should start with "sk-"');
        return;
      }
      OPENAI_API_KEY = key;
      localStorage.setItem('byzbot-api-key', key);
      showChatInterface();
    });

    apiKeyInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        saveApiKeyBtn.click();
      }
    });

    // ==================== THEME MANAGEMENT ====================
    function initTheme() {
      const savedTheme = localStorage.getItem('byzbot-theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon();
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('byzbot-theme', newTheme);
      updateThemeIcon();
    }

    function updateThemeIcon() {
      const theme = document.documentElement.getAttribute('data-theme');
      themeBtn.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }

    themeBtn.addEventListener('click', toggleTheme);
    initTheme();

    // ==================== MESSAGE HANDLING ====================
    function addMessage(content, isUser = false, showAvatar = true) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
      
      if (showAvatar) {
        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        avatar.innerHTML = isUser ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
        messageDiv.appendChild(avatar);
      }
      
      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';
      
      // Format markdown-like content
      messageContent.innerHTML = formatMessage(content);
      
      messageDiv.appendChild(messageContent);
      messagesContainer.appendChild(messageDiv);
      
      // Remove welcome message if it exists
      if (welcomeMessage && welcomeMessage.style.display !== 'none') {
        welcomeMessage.style.display = 'none';
      }
      
      scrollToBottom();
      return messageDiv;
    }

    function formatMessage(text) {
      // Simple markdown formatting
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`(.*?)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br>');
    }

    function showTypingIndicator() {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message bot';
      messageDiv.id = 'typing-indicator';
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.innerHTML = '<i class="fas fa-robot"></i>';
      
      const typingDiv = document.createElement('div');
      typingDiv.className = 'typing-indicator';
      typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
      
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(typingDiv);
      messagesContainer.appendChild(messageDiv);
      scrollToBottom();
    }

    function removeTypingIndicator() {
      const indicator = document.getElementById('typing-indicator');
      if (indicator) {
        indicator.remove();
      }
    }

    function showError(message) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
      messagesContainer.appendChild(errorDiv);
      scrollToBottom();
    }

    // ==================== OPENAI API CALL ====================
    async function getAIResponse(userMessage) {
      if (!OPENAI_API_KEY) {
        throw new Error('OpenAI API key not configured. Please add your API key.');
      }

      // Add user message to history
      conversationHistory.push({
        role: 'user',
        content: userMessage
      });

      // Prepare messages for API
      const messages = [
        {
          role: 'system',
          content: BYZ_CONTEXT
        },
        ...conversationHistory.slice(-10) // Keep last 10 messages for context
      ];

      try {
        const response = await fetch(OPENAI_API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: 'gpt-4',
            messages: messages,
            temperature: 0.7,
            max_tokens: 500
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error?.message || 'Failed to get response from AI');
        }

        const data = await response.json();
        const aiMessage = data.choices[0].message.content;

        // Add AI response to history
        conversationHistory.push({
          role: 'assistant',
          content: aiMessage
        });

        return aiMessage;
      } catch (error) {
        console.error('AI API Error:', error);
        throw error;
      }
    }

    // ==================== MESSAGE HANDLING ====================
    async function handleUserMessage(message) {
      if (!message.trim() || isProcessing) return;

      const userMessage = message.trim();
      
      // Add user message to UI
      addMessage(userMessage, true);
      
      // Clear input
      userInput.value = '';
      userInput.disabled = true;
      sendBtn.disabled = true;
      isProcessing = true;

      // Show typing indicator
      showTypingIndicator();

      try {
        // Get AI response
        const aiResponse = await getAIResponse(userMessage);
        
        // Remove typing indicator
        removeTypingIndicator();
        
        // Add AI response to UI
        addMessage(aiResponse, false);
      } catch (error) {
        removeTypingIndicator();
        showError(`Sorry, I encountered an error: ${error.message}. Please check your API key and try again.`);
        console.error('Error:', error);
      } finally {
        userInput.disabled = false;
        sendBtn.disabled = false;
        isProcessing = false;
        userInput.focus();
      }
    }

    // ==================== EVENT LISTENERS ====================
    sendBtn.addEventListener('click', () => {
      handleUserMessage(userInput.value);
    });

    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey && !isProcessing) {
        e.preventDefault();
        handleUserMessage(userInput.value);
      }
    });

    clearBtn.addEventListener('click', () => {
      if (confirm('Clear all messages?')) {
        conversationHistory = [];
        messagesContainer.innerHTML = `
          <div class="welcome-message">
            <h3>ðŸ‘‹ Welcome to ByzBot!</h3>
            <p>I'm your AI assistant for BYZ. Ask me anything about events, bookings, locations, galleries, or anything else!</p>
          </div>
        `;
      }
    });

    // Settings button - reset API key
    settingsBtn.addEventListener('click', () => {
      if (confirm('Reset API key? You\'ll need to enter it again.')) {
        localStorage.removeItem('byzbot-api-key');
        OPENAI_API_KEY = '';
        conversationHistory = [];
        showApiKeySetup();
      }
    });

    // ==================== UTILITIES ====================
    function scrollToBottom() {
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Initialize
    init();
  </script>
</body>
</html>

